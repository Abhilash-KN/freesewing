<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Brian</title>
  </head>
  <body>
    <div id="svg"></div>
    <script type="text/javascript" src="dist/browser/bundle.js"></script>
    <script type="text/javascript" src="theme-default.js"></script>
    <script type="text/javascript" src="theme-designer.js"></script>
  <script>
    var pattern = freesewing_patterns_brian;
    pattern.settings.measurements = {
      bicepsCircumference:   335,
      centerBackNeckToWaist: 480,
      chestCircumference:   1080,
      hipsCircumference:     950,
      naturalWaistToHip:     120,
      neckCircumference:     420,
      shoulderSlope:          55,
      shoulderToShoulder:    470,
      shoulderToWrist:       700,
      wristCircumference:    190
    };
    pattern.settings.paperless = true;
//pattern.on('preRenderSvg', function(next) {
//  this.attributes.add("viewBox", "-10 -10 600 800");
//  next();
//});
var macroPlugin = {
  hooks: {
    preRenderSvg: function(next) {
      console.log('in mixed plugin hooks part');
      this.attributes.add("viewBox", "-12 -12 600 800");
      next();
    }
  }
, macros: {
    cof: function(next, so) {
      console.log('in mixed plugin macros part');
      let points = this.points;
      points.cofStart = so.from.shiftTowards(so.to, 30);
      points.cofEnd = so.to.shiftTowards(so.from, 30);
      points.cofVia1 = so.from.shiftTowards(so.to, 50).rotate(90,points.cofStart);
      points.cofVia2 = so.to.shiftTowards(so.from, 50).rotate(-90,points.cofEnd);
      this.paths.cof = new this.path()
        .move(points.cofStart)
        .line(points.cofVia1)
        .line(points.cofVia2)
        .line(points.cofEnd)
        .attr('class', 'cut-on-fold');
      next();
    }
  }
}
//pattern.macro('cof', function(next, so) {
//  let points = this.points;
//  points.cofStart = so.from.shiftTowards(so.to, 30);
//  points.cofEnd = so.to.shiftTowards(so.from, 30);
//  points.cofVia1 = so.from.shiftTowards(so.to, 50).rotate(90,points.cofStart);
//  points.cofVia2 = so.to.shiftTowards(so.from, 50).rotate(-90,points.cofEnd);
//  this.paths.cof = new this.path()
//    .move(points.cofStart)
//    .line(points.cofVia1)
//    .line(points.cofVia2)
//    .line(points.cofEnd)
//    .attr('class', 'cut-on-fold');
//  next();
//});
//pattern.on('postRenderSvg', function(next) {
//  this.svg = this.svg.replace('green', 'yellow');
//  next();
//});
//console.log(freesewing_theme_default);
pattern.withPlugin(freesewing_theme_designer);
pattern.withPlugin(freesewing_theme_default);
pattern.withPlugin(macroPlugin);
    pattern.draft();
    document.getElementById("svg").innerHTML = pattern.render();
    function pointHover(evt) {
      var point = evt.target;
      var id = point.id;
      var cx = point.getAttribute('x');
      var cy = point.getAttribute('y');
      var name = point.getAttribute('data-point');
      var part = point.getAttribute('data-part');
      console.log(name+' ('+cx+', '+cy+') @ '+part);
      var scale = 2;
      cx = cx-scale*cx;
      cy = cy-scale*cy;
      point.setAttribute("transform", 'matrix('+scale+', 0, 0, '+scale+', '+cx+', '+cy+')');
      pointUnhover(id);
    }
    function pointUnhover(id) {
      setTimeout(function(){
          document.getElementById(id).removeAttribute("transform", '');
      }, 500);
    }
  </script>
  </body>
</html>
